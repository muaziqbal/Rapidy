server {
  listen <%= @http_port %>;
  server_name <%= @host %>;
  rewrite ^(.*)$ https://$host:<%= @https_port %>$1 redirect;
}

server {
  listen <%= @https_port %>;
  server_name <%= @host %>;

  ssl on;
  ssl_certificate <%= @cert_dir %>/certificate.crt;
  ssl_certificate_key <%= @cert_dir %>/certificate.key;

  passenger_enabled on;
  passenger_min_instances 1;

  rails_env <%= @rails_env %>;
  gzip on;
  gzip_disable "MSIE [1-6]\.";

  root <%= @release_dir %>/public;
  access_log <%= @release_dir %>/log/server.log;
  error_log <%= @release_dir %>/log/error.log error;
  client_max_body_size 50M;

  location ~ ^/assets/ {
    expires 1y;
    add_header Cache-Control public;
    add_header ETag "";
    break;
  }
}

passenger_pre_start https://<%= @host %>:<%= @https_port %>/;
